<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <meta content="流浪貓咪認養平台，提供公立收容所貓咪資料，以及收容所聯絡方式，歡迎參考貓咪資訊後，直接聯繫收容所進行認養" name="description">
  <meta content="cat adoption, 貓咪領養, 流浪貓, 流浪動物之家" name="keywords">
  <title>領我回家 Take me home | 流浪貓認養平台</title>
  <!-- Favicons -->
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700" rel="stylesheet">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
  <link rel="stylesheet" href="plugin/owlcarousel/assets/owl.carousel.min.css">
  <link rel="stylesheet" href="plugin/owlcarousel/assets/owl.theme.default.min.css">
  <link rel="stylesheet" href="https://unpkg.com/aos@2.3.1/dist/aos.css">
  <link rel="stylesheet" href="css/custom.css">
  
  <!-- script -->
  <script src="plugin/jquery-3.5.1.min.js"></script>
  <script src="plugin/jquery.easing.min.js"></script>
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="plugin/owlcarousel/owl.carousel.min.js"></script>
  <script src="plugin/typed.js"></script>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-Y10Y0E0PG5"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-Y10Y0E0PG5');
  </script>
</head>

<body>
  <script> // init AOS.js
    AOS.init();
  </script>
  <header>
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-baseline align-items-md-center py-2 px-3 px-lg-5 fixed-top" id="header">
      <div class="d-flex justify-content-between" id="topbarnd">
        <a href="#" class="brand d-flex align-items-start align-items-md-center">
          <img src="img/00cat-256.png" width="50px" alt="logo" class="p-2">
          <span class="m-0 py-2 font-weight-bolder c-g-4">領我回家 <span class="c-p-5">Take</span><span class="c-p-8">Me</span><span class="c-p-5">Home</span></span>
        </a>
        <!-- 利用class 變形導航icon 三 => X -->
        <div class="d-flex d-md-none" aria-label="切換導航欄" id="nav-toggle">
          <div class="toggle-line-1"></div>
          <div class="toggle-line-2"></div>
          <div class="toggle-line-3"></div>
        </div>  
      </div>
      <ul class="nav flex-column flex-md-row justify-content-md-end">
        <li class="nav-item">
          <a class="nav-link" href="#">回首頁</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#cats">最新收容貓咪</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#shelter">收容所資訊</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#contact">聯絡站長</a>
        </li>
      </ul>
    </div>
  </header>
  <main>
    <section id="banner">
      <div class="container py-3">
        <div class="row justify-content-center my-3 topic" data-aos="flip-up" data-aos-duration="1000">
          <div class="box-1"></div>
          <div class="box-2"></div>
          <span>浪貓認養平台</span> 
        </div>
        <div class="row justify-content-center mb-2">
          <div class="col-12 col-sm-10 col-md-8 col-lg-6 col-xl-5 c-r-1 font-weight-bolder typed1">
          </div>
        </div>
        <script> // typed.js  for banner slogan
          //  打字效果 https://github.com/mattboldt/typed.js/ 
            new Typed('.typed1', {
              strings: ['你在等我嗎？^1500 我在這裡期待給你溫暖的陪伴~ &hearts; ^4000 '],
              loop: true,
              typeSpeed: 20,
              backSpeed: 0,
              backDelay: 0,
              showCursor: false,
              fadeIn:true,
              fadeOut: true,
              fadeOutClass: 'typed-fade-out',
              fadeOutDelay: 1000,
            });
        </script>
        <div class="row justify-content-center">
          <div class="owl-carousel owl-theme">
            <div class="item"><img src="img/cats/P6107432.jpg" alt="cat pic"></div>
            <div class="item"><img src="img/cats/1560052126894.jpeg" alt="cat pic"></div>
            <div class="item"><img src="img/cats/P5267147.JPG" alt="cat pic"></div>
            <div class="item"><img src="img/cats/1581783005006.jpg" alt="cat pic"></div>
            <div class="item"><img src="img/cats/PA255019.jpg" alt="cat pic"></div>
            <div class="item"><img src="img/cats/OI000659.JPG" alt="cat pic"></div>
          </div>
        </div>
      </div>
    </section>
    <script> // owl carousel   for banner
      $('.owl-carousel').owlCarousel({
          center: true,
          items:1,
          loop:true,
          dots:true,
          autoplay:true,
      });
    </script>
    <section id="cats">
      <div class="container py-3">
        <div class="row justify-content-center my-3 topic" data-aos="flip-up" data-aos-duration="1000">
          <div class="box-1"></div>
          <div class="box-2"></div>
          <span>最新收容貓咪</span> 
        </div>
        <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 row-cols-xl-4" id="newCats">
          <!-- 主要card code -->
        </div>
          <!-- 抓取API資料 -->
        <script> // 網頁開啟時先抓8筆資料，生成card，後續擴充功能，隨滑鼠滾動load更多資料，或點擊獲得更多
          let nw = new Date();
          let nwDate = nw.getDate();
          
          let qtyCatCard=$("#newCats").children().length;
          let uCatCard=$("#newCats").children().find("div.card:hidden").length
          let stCard=0;

          function padLeft(num) { // 補0 至num位
            return num.toString().padStart(2, '0');
          }

          function newCatCard(qty) { // 一次生成 qty 貓咪卡片，且顯示從strt數起的qty卡片
            let newD=new Date(new Date().setDate(nwDate))
            let 
              newYear = newD.getFullYear(),
              newMonth = newD.getMonth()+1,
              newDate = newD.getDate();

            let Mn = padLeft(newMonth); // 從最新的month開始抓資料
            let Dt = padLeft(newDate); // 從最新的date開始抓資料
            $.ajax({
              url: "api/api_CURL.php",
              method: "get",
              data: {
                "top":100,
                "skip":0,
                // "skip":0+100*(page-1),
                "animal_createtime":newYear+"/"+Mn+"/"+Dt,},
              dataType: "json",
              success: function(re){
                if (re.length == 0) {
                  console.log(newYear+"/"+Mn+"/"+Dt,"no data")
                  nwDate--; // 從最近的日期沒資料，就往前一天抓
                  newCatCard(qty);
                } else {
                  // console.log(re)
                  re.forEach(e => {
                    if(e.album_file!=""){ // 只抓 有照片 的資料
                      qtyCatCard++;
                      if (e.animal_age=="ADULT") e.animal_age='成貓';
                      if (e.animal_age=="CHILD") e.animal_age='幼貓';
                      if (e.animal_sex=="F") e.animal_sex="母";
                      if (e.animal_sex=="M") e.animal_sex="公";
                      if (e.animal_sex=="N") e.animal_sex="(?)";
                      html=`<div class="col mb-4" style="display:none">
                              <div class="card" onclick="addCatModal(${e.animal_id})" data-toggle="modal" data-target="#Modal${e.animal_id}">
                                <img src="${e.album_file}" class="card-img-top">
                                <div class="card-body">
                                  <div class="card-title"><span class="h5 font-weight-bolder">${e.animal_colour.substr(0,3)}${e.animal_sex}${e.animal_kind}</span><span class="text-warning">${e.animal_age} ${e.animal_id}</span></div>
                                  <p class="card-text">發現地點：<span>${e.animal_foundplace.substr(0,6)}...</span></p>
                                  <p class="card-text">目前位置：<span>${e.shelter_name.substr(0,6)}...</span></p>
                                  <p class="card-text">資料建立時間：<span>${e.animal_createtime}</span></p>
                                </div>
                              </div>
                            </div>`;
                      $(html).appendTo('#newCats');
                      console.log(e.animal_id,e.animal_createtime,qtyCatCard);
                    }
                    else{
                      console.log(e.animal_id,"no pic",qtyCatCard);
                    }
                  })
                  console.log(qtyCatCard,qty,newYear+"/"+Mn+"/"+Dt)
                  if(qtyCatCard<qty){
                    nwDate--;
                    newCatCard(qty)
                  }
                }
              }
            }).then(()=>{
              showCatCard(qty)
            })
          }

          function showCatCard(qty){
            for (let i = stCard; i < qty; i++) {
                $("#newCats").children().eq(i).fadeIn(1000);
            }
          }

          function addCatCard(qty){
            nwDate--;
            strt=$("#newCats").children().length-$("#newCats").children().find("div.card:hidden").length
            newCatCard(qty)
          }

          newCatCard(12); 
        </script>
        <div class="row justify-content-center align-items-center" id="catModal">
          <!-- Modal -->
        </div>        
        <!-- Modal彈出內容  -->
        <script> // 點擊card 出現貓咪細節資料 modal應用
          function addCatModal(id){
            let url =`https://agridata.coa.gov.tw/api/v1/AnimalRecognition/?animal_id=${id}&%24top=1000&Page=1`;
            let remark="";
            $.getJSON(url)
            .done((re)=>{
              console.log(re.Data[0]);
              let e=re.Data[0];
              if (e.animal_remark!=""){remark=`<p class="p2 font-weight-bolder text-danger">${e.animal_remark}</p>`};
              if (e.animal_bodytype=="SMALL") e.animal_bodytype='小型';
              if (e.animal_bodytype=="MEDIUM") e.animal_bodytype='中型';
              if (e.animal_age=="ADULT") e.animal_age='成貓';
              if (e.animal_age=="CHILD") e.animal_age='幼貓';
              if (e.animal_sex=="F") e.animal_sex="母";
              if (e.animal_sex=="M") e.animal_sex="公";
              if (e.animal_sex=="N") e.animal_sex="(不確定性別)";
              if (e.animal_opendate=="") e.animal_opendate="待開放"
              switch(e.animal_bacterin){
                case "T": e.animal_bacterin="已接種"
                  break;
                case "F": e.animal_bacterin="尚未接種"
                  break;
                case "N": e.animal_bacterin="待確認"
                  break;
              }
              let html=
                `<div class="modal fade" id="Modal${id}" tabindex="-1" role="dialog" aria-labelledby="ModalLabel${id}" aria-hidden="true" style="padding-right:0">
                  <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                      <div class="modal-header text-center">
                        <div class="modal-title" id="ModalLabel${id}">
                          <div class="d-inline-block font-weight-bolder h4 m-0 c-o-1">${e.animal_colour}${e.animal_sex}${e.animal_kind}</div>&nbsp&nbsp&nbsp&nbsp
                          <div class="d-inline-block c-o-2">${e.animal_bodytype}${e.animal_age}</div>
                        </div>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                        </button>
                      </div>
                      <div class="modal-body">
                        <img class="card-img" src="${e.album_file}">
                        <p class="p0">ID:${e.animal_id}</p>
                        <p class="p1">發現地點：${e.animal_foundplace}</p>
                        ${remark}
                      </div>
                      <div class="modal-footer d-flex flex-column align-items-start">
                        <div>目前位置：<span class="font-weight-bolder">${e.shelter_name}</span></div>
                        <div>地址：<span class="font-weight-bolder">${e.shelter_address}</span></div>
                        <div>電話：<span class="font-weight-bolder">${e.shelter_tel}</span></div>
                        <div>狂犬病疫苗：${e.animal_bacterin}</div>
                        <div>開放認養日：${e.animal_opendate}</div>
                      </div>
                    </div>
                  </div>
                </div>`;
              $(html).appendTo("#catModal");
              $(`#Modal${id}`).modal('show')
            })
            .fail(()=>{alert("資料來源異常，無法正常取得資料")})
            }
        </script>
        <div class="row justify-content-center">
          <button class="c-r-1 font-weight-bolder" onclick="addCatCard(12)">更多猫咪</button>
        </div>
      </div>
    </section>
    <section id="shelter">
      <div class="container py-3">
        <div class="row justify-content-center my-3 topic" data-aos="flip-up" data-aos-duration="1000">
          <div class="box-1"></div>
          <div class="box-2"></div>
          <span>收容所資訊</span> 
        </div>
        <div class="row justify-content-center">...資料建立中...</div>
      </div>
    </section>

    <section id="contact">
      <div class="container py-3">
        <div class="row justify-content-center my-3 topic" data-aos="flip-up" data-aos-duration="1000">
          <div class="box-1"></div>
          <div class="box-2"></div>
          <span>聯絡站長</span> 
        </div>
        <div class="row justify-content-center">...資料建立中...</div>
      </div>
    </section>
  </main>

  <footer>
    <div class="d-flex flex-column flex-sm-row justify-content-center justify-content-sm-between align-items-center px-4 py-2" id="footer">
        <div>
          <a href="#" class="d-flex align-items-center">
            <img src="img/00cat-256.png" width="35px" alt="logo" class="p-2">
            <span class="m-0 py-2 font-weight-bolder c-g-4">領我回家 <span class="c-p-5">Take</span><span class="c-p-8">Me</span><span class="c-p-5">Home</span></span>
          </a>  
        </div>
        <div class="d-flex flex-column align-items-center align-items-sm-end">
          <p class="col text-center text-sm-right">綾凌設計|版權所有</p>
          <p class="col">&copy; 2020 &nbsp;<strong>Lingling Chang</strong>. All rights reserved.</p>
        </div>
    </div>
    <div id="scrolltop" class="position-fixed shown">
      <a class="d-inline-block" href="#"><i class="fas fa-angle-double-up fa-2x"></i></a>
    </div>
  </footer>

  <script> 
    // 控制導覽列 寬螢幕在上方，小螢幕縮為toggle
    $("#nav-toggle").on("click",(event)=>{
      var item = event.currentTarget;
      // console.log("OOO")
      $(".nav").toggle();
      if (item.classList.contains("act")){
        $("#nav-toggle").removeClass("act")
        $(".toggle-line-2").toggle().fadeIn();
        $(".toggle-line-1").removeClass("toggle-line-first")
        $(".toggle-line-3").removeClass("toggle-line-last")
      }
      else{
        // console.log("XXX")
        $("#nav-toggle").addClass("act")
        $(".toggle-line-2").toggle();
        $(".toggle-line-1").addClass("toggle-line-first")
        $(".toggle-line-3").addClass("toggle-line-last")
      }
      mainMargin()
    })
  
    // 隨header高度，調整main的位置
    function mainMargin(){
      $("main").css("margin-top",$("#header").outerHeight(true))
    }
    
    function debounce(fn, wait) {
      var timeout = null;
      return function() {
        if(timeout !== null)
        clearTimeout(timeout);
        timeout = setTimeout(fn, wait);
      }
    }
    window.addEventListener('resize', debounce(mainMargin, 100));
    mainMargin()

    // 這段是啥小？？
    // Activate smooth scroll on page load with hash links in the url
    $(document).ready(function () {
      if (window.location.hash) {
        var initial_nav = window.location.hash;
        if ($(initial_nav).length) {
          var scrollto = $(initial_nav).offset().top;
          $('html, body').animate({
            scrollTop: scrollto
          }, 1500, 'easeInOutExpo');
        }
      }
    });


    // let 
    // headerH=$("#header").innerHeight(),
    // bannerH=$("#banner").innerHeight(),
    // catsH=$("#cats").innerHeight(),
    // shelterH=$("#shelter").innerHeight(),
    // contactH=$("#contact").innerHeight(),
    // footerH=$("#footer").innerHeight();
    // console.log(headerH,bannerH,catsH,shelterH,contactH,footerH);

    // 下方回首頁的提示 跳跳icon 要執行跳回去的高度 + icon顯示控制
    function goTop() {
      let
        nowat = $(window).scrollTop(),
        height=$("#header").innerHeight()+$("#banner").innerHeight()-100;
      // console.log(nowat,height)
      if (nowat <= height) {
        $("#scrolltop").removeClass("shown");
      } else {
        $("#scrolltop").addClass("shown");
      }
    }

    // 跳至指定#時 移動效果+高度控制
    $("#header a, #scrolltop a").click(function () {
      let who = $(this).attr("href");
      if (who=="#"){who="#banner"}
      let val = $(who).offset().top - $("#header").innerHeight() + 1;
      // console.log(who,val)
      
      $("html").animate(
        { scrollTop: val }, 1000, "swing"
      );
    });

    // function navActive(){
    //   let 
    //     headerH=$("#header").offset().top,
    //     bannerH=$("#banner").offset().top,
    //     catsH=$("#cats").offset().top,
    //     shelterH=$("#shelter").offset().top,
    //     contactH=$("#contact").offset().top,
    //     footerH=$("#footer").offset().top;
    //     console.log(headerH,bannerH,catsH,shelterH,contactH,footerH);
    //   let nowat=$(window).scrollTop();
    //   if(nowat>contactH){
        
    //   }
      
    // }

    $(window).scroll(() => {
      goTop(); // bounce to top
      spy(); // scroll spy
    });

    function spy() {
      let nowat = $(window).scrollTop();
      $('section').each(function () {
        let
          id = $(this).attr('id'),
          offset = $(this).offset().top - $("#header").innerHeight(),
          height = $(this).innerHeight();
          // console.log(id,nowat,offset,height)
        if (offset <= nowat && nowat < offset + height) {
          $("#header a").removeClass('active');
          $(`#header a[href='#${id}']`).addClass('active');
        };
      });
    }

  </script>
</body>
</html>