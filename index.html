<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <meta content="流浪貓咪認養平台，提供公立收容所貓咪資料，以及收容所聯絡方式，可參考照片後直接聯繫、認養" name="description">
  <meta content="cat adoption, 貓咪領養, 流浪貓, 流浪動物之家" name="keywords">
  <title>領我回家 Take me home | 流浪貓認養平台</title>
  <!-- Favicons -->
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700" rel="stylesheet">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.0.0-beta.2.4/assets/owl.carousel.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.0.0-beta.2.4/assets/owl.theme.default.min.css">
  <link rel="stylesheet" href="https://unpkg.com/aos@2.3.1/dist/aos.css">
  <link rel="stylesheet" href="plugin/custom.css">
  
  <!-- script -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.0.0-beta.2.4/owl.carousel.min.js"></script>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-Y10Y0E0PG5"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-Y10Y0E0PG5');
  </script>
</head>

<body>
  <script> 
    AOS.init();
  </script>
  <header>
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-baseline align-items-md-center py-2 px-3 px-lg-5 fixed-top" id="header">
      <div class="d-flex justify-content-between" id="topbarnd">
        <a href="index.html" class="brand d-flex align-items-start align-items-md-center">
          <img src="img/00cat-256.png" width="50px" alt="logo" class="p-2">
          <span class="m-0 py-2 font-weight-bolder c-g-4">領我回家 <span class="c-p-5">Take</span><span class="c-p-8">Me</span><span class="c-p-5">Home</span></span>
        </a>
        <div class="d-flex d-md-none" aria-label="切換導航欄" id="nav-toggle">
          <div class="toggle-line-1"></div>
          <div class="toggle-line-2"></div>
          <div class="toggle-line-3"></div>
        </div>  
      </div>
      <ul class="nav flex-column flex-md-row justify-content-md-end">
        <li class="nav-item">
          <a class="nav-link active" href="index.html">回首頁</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#cats">最新收容貓咪</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#shelter">收容所資訊</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#contact">聯絡站長</a>
        </li>
      </ul>
    </div>
    <script> // 控制導覽列 寬螢幕在上方，小螢幕縮為toggle
      $("#nav-toggle").on("click",(event)=>{
        var item = event.currentTarget;
        console.log("OOO")
        $(".nav").toggle();
        if (item.classList.contains("act")){
          $("#nav-toggle").removeClass("act")
          $(".toggle-line-2").toggle().fadeIn();
          $(".toggle-line-1").removeClass("toggle-line-first")
          $(".toggle-line-3").removeClass("toggle-line-last")
        }
        else{
          console.log("XXX")
          $("#nav-toggle").addClass("act")
          $(".toggle-line-2").toggle();
          $(".toggle-line-1").addClass("toggle-line-first")
          $(".toggle-line-3").addClass("toggle-line-last")
        }
        mainMargin()
      })
    </script>
  </header>
  <main>
    <script> // 隨header高度，調整main的位置
      mainMargin()
      function mainMargin(){
        $("main").css("margin-top",$("#header").outerHeight(true))
      }

      function debounce(fn, wait) {
            var timeout = null;
            return function() {
                if(timeout !== null)
                    clearTimeout(timeout);
                timeout = setTimeout(fn, wait);
            }
      }

      window.addEventListener('resize', debounce(mainMargin, 100));
    </script>
    <div id="banner">
      <div class="container py-3">
        <div class="row justify-content-center my-3 topic" data-aos="flip-up" data-aos-duration="1000">
          <div class="box-1"></div>
          <div class="box-2"></div>
          <span>流浪貓咪認養平台</span> 
        </div>
        <div class="row justify-content-center">...資料建立中...</div>
      </div>
      <div class="owl-carousel owl-theme">
        <div class="item"><img src="img/cats/FB_IMG_1603723225998.jpg" alt="cat pic"></div>
        <div class="item"><img src="img/cats/1560052126894.jpeg" alt="cat pic"></div>
        <div class="item"><img src="img/cats/P5267147.JPG" alt="cat pic"></div>
        <div class="item"><img src="img/cats/1581783005006.jpg" alt="cat pic"></div>
        <div class="item"><img src="img/cats/OI000659.JPG" alt="cat pic"></div>
        <!-- <div> Your Content </div>
        <div> Your Content </div>
        <div> Your Content </div>
        <div> Your Content </div>
        <div> Your Content </div>
        <div> Your Content </div>
        <div> Your Content </div> -->
      </div>
    </div>
    <script>
      $(document).ready(()=>{
        $(".owl-carousel").owlCarousel({
          item:1,
          autoplay:true
        })
      })
    </script>
    <div id="cats">
      <div class="container py-3">
        <div class="row justify-content-center my-3 topic" data-aos="flip-up" data-aos-duration="1000">
          <div class="box-1"></div>
          <div class="box-2"></div>
          <span>最新收容貓咪</span> 
        </div>
        <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 row-cols-xl-4" id="newCats">
          <!-- 主要card code範例 -->
          <!-- <div class="col mb-4">
            <div type="button" class="card" data-toggle="modal" data-target="#exampleModal" onclick="addCatModal(1)">
              <img src="img/cats/1560052126894.jpeg" class="card-img-top">
              <div class="card-body">
                <h5 class="card-title"><span class="colour">虎斑色</span><span class="sex">公貓</span></h5>
                <p class="card-text"><span class="age">成貓</span><span class="id">F123412312</span></p>
                <p class="card-text">發現地點：<span>南勢角路邊</span></p>
                <p class="card-text">目前位置：<span>新店綠中海</span></p>
              </div>
            </div>
          </div> -->
          <!-- 主要card code範例 -->        
        </div>
        <script> // 點擊card 出現貓咪細節資料 modal應用
          function addCatModal(id){
            let url =`https://agridata.coa.gov.tw/api/v1/AnimalRecognition/?animal_id=${id}&%24top=1000&Page=1`;
            let remark="";
            $.getJSON(url)
            .done((re)=>{
              console.log(re.Data[0]);
              let e=re.Data[0];
              if (e.animal_remark!=""){remark=`<p class="p2 font-weight-bolder text-danger">${e.animal_remark}</p>`};
              if (e.animal_bodytype=="SMALL") e.animal_bodytype='小型';
              if (e.animal_bodytype=="MEDIUM") e.animal_bodytype='中型';
              if (e.animal_age=="ADULT") e.animal_age='成貓';
              if (e.animal_age=="CHILD") e.animal_age='幼貓';
              if (e.animal_sex=="F") e.animal_sex="母";
              if (e.animal_sex=="M") e.animal_sex="公";
              if (e.animal_sex=="N") e.animal_sex="(不確定性別)";
              if (e.animal_opendate=="") e.animal_opendate="待開放"
              switch(e.animal_bacterin){
                case "T": e.animal_bacterin="已接種"
                  break;
                case "F": e.animal_bacterin="尚未接種"
                  break;
                case "N": e.animal_bacterin="待確認"
                  break;
              }
              let html=
                `<div class="modal fade" id="Modal${id}" tabindex="-1" role="dialog" aria-labelledby="ModalLabel${id}" aria-hidden="true" style="padding-right:0">
                  <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                      <div class="modal-header text-center">
                        <div class="modal-title" id="ModalLabel${id}">
                          <div class="d-inline-block font-weight-bolder h4 m-0 c-o-1">${e.animal_colour}${e.animal_sex}${e.animal_kind}</div>&nbsp&nbsp&nbsp&nbsp
                          <div class="d-inline-block c-o-2">${e.animal_bodytype}${e.animal_age}</div>
                        </div>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                        </button>
                      </div>
                      <div class="modal-body">
                        <img class="card-img" src="${e.album_file}">
                        <p class="p0">ID:${e.animal_id}</p>
                        <p class="p1">發現地點：${e.animal_foundplace}</p>
                        ${remark}
                      </div>
                      <div class="modal-footer d-flex flex-column align-items-start">
                        <div>目前位置：<span class="font-weight-bolder">${e.shelter_name}</span></div>
                        <div>地址：<span class="font-weight-bolder">${e.shelter_address}</span></div>
                        <div>電話：<span class="font-weight-bolder">${e.shelter_tel}</span></div>
                        <div>狂犬病疫苗：${e.animal_bacterin}</div>
                        <div>開放認養日：${e.animal_opendate}</div>
                      </div>
                    </div>
                  </div>
                </div>`;
              $(html).appendTo("#catModal");
              $(`#Modal${id}`).modal('show')
            })
            .fail(()=>{alert("資料來源異常，無法正常取得資料")})
            }
        </script>
        <!-- Modal -->
        <div class="row justify-content-center align-items-center" id="catModal">
        </div>        
        <!-- Modal  -->
      </div>
    </div>

    <div id="shelter">
      <div class="container py-3">
        <div class="row justify-content-center my-3 topic" data-aos="flip-up" data-aos-duration="1000">
          <div class="box-1"></div>
          <div class="box-2"></div>
          <span>收容所資訊</span> 
        </div>
        <div class="row justify-content-center">...資料建立中...</div>
      </div>
    </div>

    <div id="contact">
      <div class="container py-3">
        <div class="row justify-content-center my-3 topic" data-aos="flip-up" data-aos-duration="1000">
          <div class="box-1"></div>
          <div class="box-2"></div>
          <span>聯絡站長</span> 
        </div>
        <div class="row justify-content-center">...資料建立中...</div>
      </div>
    </div>

    <!-- 抓取API資料 -->
    <script> // 先抓12筆，後續擴充功能，再增加 【看看更多貓咪】按鈕，load更多資料
      let nw = new Date();
      let nwYear = nw.getFullYear();
      let nwMonth = nw.getMonth()+1;
      let nwDate = nw.getDate();
      let qtyCatCard=$("#newCats").children().length;

      function padLeft(num) { // 補0 至num位
        return num.toString().padStart(2, '0');
      }

      function newCatCard(qty,page) { // 一次生成 qty 貓咪卡片，且顯示qty卡片，第page頁
        let Mn = padLeft(nwMonth); // 從最新的month開始抓資料
        let Dt = padLeft(nwDate); // 從最新的date開始抓資料
        $.ajax({
          url: "api/api_CURL.php",
          method: "get",
          data: {
            "top":20,
            "skip":0+20*(page-1),
            "animal_createtime":nwYear+"/"+Mn+"/"+Dt,},
          dataType: "json",
          success: function(re){
            if (re.length == 0) {
              console.log(nwYear+"/"+Mn+"/"+Dt,"no data")
              nwDate--; // 從最近的日期沒資料，就往前一天抓
              newCatCard(qty,page);
            } else {
              console.log(re)
              re.forEach(e => {
                if(e.album_file!=""){ // 只抓 有照片 的資料
                  qtyCatCard++;
                  if (e.animal_age=="ADULT") e.animal_age='成貓';
                  if (e.animal_age=="CHILD") e.animal_age='幼貓';
                  if (e.animal_sex=="F") e.animal_sex="母";
                  if (e.animal_sex=="M") e.animal_sex="公";
                  if (e.animal_sex=="N") e.animal_sex="(?)";
                  html=`<div class="col mb-4" style="display:none">
                          <div class="card" onclick="addCatModal(${e.animal_id})" data-toggle="modal" data-target="#Modal${e.animal_id}">
                            <img src="${e.album_file}" class="card-img-top">
                            <div class="card-body">
                              <div class="card-title"><span class="h5 font-weight-bolder">${e.animal_colour.substr(0,3)}${e.animal_sex}${e.animal_kind}</span><span class="text-warning">${e.animal_age} ${e.animal_id}</span></div>
                              <p class="card-text">發現地點：<span>${e.animal_foundplace.substr(0,6)}...</span></p>
                              <p class="card-text">目前位置：<span>${e.shelter_name.substr(0,6)}...</span></p>
                              <p class="card-text">資料建立時間：<span>${e.animal_createtime}</span></p>
                            </div>
                          </div>
                        </div>`;
                  $(html).appendTo('#newCats');
                  console.log(e.animal_id,e.animal_createtime,qtyCatCard);
                }
                else{
                  console.log(e.animal_id,"no pic",qtyCatCard);
                }
              })
              console.log(qtyCatCard,qty,nwYear+"/"+Mn+"/"+Dt)
              if(qtyCatCard<qty){
                nwDate--;
                newCatCard(qty,page)
              }
            }
          }
        }).then(() => {
        showCatCard(qty)
        })
      }
      function showCatCard(qty){
        for (let i = 0; i < qty; i++) {
            $("#newCats").children().eq(i).fadeIn(800);
        }
      }

      newCatCard(12,1)
    </script>


  </main>

  <footer>
    <div class="d-flex flex-column flex-sm-row justify-content-center justify-content-sm-between align-items-center px-4 py-2" id="footer">
        <div>
          <a href="index.html" class="d-flex align-items-center">
            <img src="img/00cat-256.png" width="35px" alt="logo" class="p-2">
            <span class="m-0 py-2 font-weight-bolder c-g-4">領我回家 <span class="c-p-5">Take</span><span class="c-p-8">Me</span><span class="c-p-5">Home</span></span>
          </a>  
        </div>
        <div class="d-flex flex-column align-items-center align-items-sm-end">
          <p class="col text-center text-sm-right">綾凌設計|版權所有</p>
          <p class="col">&copy; 2020 &nbsp;<strong>Lingling Chang</strong>. All rights reserved.</p>
        </div>
    </div>
    <div id="scrolltop" class="position-fixed shown">
      <a class="d-inline-block" href="index.html"><i class="fas fa-angle-double-up fa-2x"></i></a>
    </div>
  </footer>
  <script>
    function goTop() {
      let
        nowat = $(window).scrollTop(),
        height = $("#banner").height()+100;
      if (nowat <= height) {
        $("#scrolltop").removeClass("shown");
      } else {
        $("#scrolltop").addClass("shown");
      }
    }
    $(window).scroll(() => {
      goTop(); // bounce to top
    });
  </script>
</body>
</html>